  		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span7">

      				<!-- Map container -->
					<div class="row-fluid">
						<div id="map" class= "affix-top">
							<div class="alert alert-info">
								<button type="button" class="close" data-dismiss="alert">×</button>
								<strong>Loading Map..</strong>
							</div>
						</div>
 					</div>
				</div>

		    	<!-- Search Results -->
    			<div class="span5">
					<ul id="myTab" class="nav nav-tabs">
						<li class="active">
	  						<a href="#options" data-toggle="tab"><b>Search Options</b></a>
						</li>
						<li>
	  						<a href="#results" data-toggle="tab"><b>Search Results</b></a>
						</li>
					</ul>

      				<div id="myTabContent" class="tab-content">

						<div class="tab-pane fade in active" id="options">
							
							<form class="form-horizontal">

								<div class="control-group">
									<label class="control-label" for="type"><strong>I would like to</strong></label>
									<div class="controls">
										<select class="span6" id="type">
	      									<option value="rent" selected="selected">Rent an apartment</option>
	      									<option value="buy">Buy an apartment</option>
	    								</select>
									</div>
								</div>
								
								<div class="control-group">
									<label class="control-label" for="address"><strong>Near</strong></label>
									<div class="controls">
										<input type="text" class="span10" id="address" placeholder="Enter society name or nearby landmark">
										<input type="hidden" id="lat">
										<input type="hidden" id="lng">
									</div>
								</div>
								
								<div class="control-group">
									<label class="control-label" for="radius"><strong>Within</strong></label>
									<div class="controls">
										<select class="span5" id="radius">
				      						<option value="2000">2 Km distance</option>
				      						<option value="5000" selected="selected">5 Km distance</option>
										    <option value="10000">10 Km distance</option>
										    <option value="15000">15 Km distance</option>
										    <option value="20000">20 Km distance</option>
										    <option value="30000">30 Km distance</option>
				    					</select>
									</div>
								</div>
							
								<div class="control-group">
									<label class="control-label" for="bedrooms"><strong>With Bedrooms</strong></label>
									<div class="controls">
										<select multiple="multiple" class="span5" id="bedrooms">
									        <option value="0">No Preference</option>
									        <option value="1" selected="selected">1</option>
									        <option value="2">2</option>
									        <option value="3">3</option>
									        <option value="4">4</option>
									        <option value="4+">4+</option>
				    					</select>
									</div>
								</div>
	    					
	    						<div class="control-group">
									<label class="control-label" for="budget"><strong>Budget <img src="images/rupee_symbol.png" alt="Rs."></img></strong></label>
									<div class="controls">
										<select class="span6" id="budget">
				      						<option value="0">No Preference</option>
				      						<option value="5" selected="selected">5,000 - 10,000</option>
				      						<option value="10">10,000 - 15,000</option>
										    <option value="15">15,000 - 20,000</option>
										    <option value="20">20,000 - 25,000</option>
										    <option value="25">25,000 - 30,000</option>
										    <option value="30">Above 30,000</option>
				    					</select>
									</div>
								</div>
	    					
								<div class="control-group">
									<label class="control-label" for="furnishing"><strong>Furnishing</strong></label>
									<div class="controls" id="furnishing">
										<select class="span5">
				      						<option value="0" selected="selected">No Preference</option>
				      						<option value="1">Non-Furnished</option>
				      						<option value="2">Semi-Furnished</option>
				      						<option value="3">Fully-Furnished</option>
				    					</select>
									</div>
								</div>
	    			
								<div class="control-group">
									<label class="control-label" for="sortby"><strong>Sorted By</strong></label>
									<div class="controls" id="sort_by">
										<select class="span4">
				      						<option value="dst" selected="selected"> Distance</option>
				      						<option value="date"> Date</option>
				      						<option value="price"> Price</option>
				    					</select>
									</div>
								</div>
	    					
	    						<div class="control-group">
									<div class="controls">
										<a class="btn btn-primary" id="search">Search Apartments</a>
									</div>
								</div>
								
	    					</form>

						</div>

						<div class="tab-pane fade" id="results">

	  					<!-- Start Here -->
							<div class="row-fluid">

	    						<div class="span12">

			      					<div class="row-fluid">
										<span><b><script type="IN/MemberProfile" data-id="http://www.linkedin.com/in/amargoel" data-format="click" data-text="Amar Goel" data-related="false"></script> </b><i class="icon-arrow-right"></i> Owner</span>
										<table class="table table-bordered table-striped table-condensed">
		  									<thead>
		    									<tr>
		      										<th>Type</th>
		      										<th>Area</th>
		      										<th>Rent</th>
		      										<th>Deposit</th>
												    <th>Distance</th>
												    <th>Published</th>
		    									</tr>
		  									</thead>
		  									<tbody>
		    									<tr>
		      										<td>2 BHK</td>
		      										<td>1,200 Sq Ft</td>
		      										<td><img src="images/rupee_symbol.png" alt="Rs."></img> 16,000</td>
		      										<td><img src="images/rupee_symbol.png" alt="Rs."></img> 50,000</td>
		      										<td>0.5 Km</td>
		      										<td>31 July</td>
		    									</tr>
		    									<tr>
		      										<td colspan="6">
														<i class="icon-home"></i> <a href="#" id="route" rel="tooltip" title="Click to view apartment on map">Ambanagari, Vishrantwadi, Pune</a>
		      										</td>
		    									<tr>
		  									</tbody>
										</table>
		  								<a data-toggle="modal" href="#myModal"> View Images </a> |
		  								<a href="#details"> View Details </a> |
		  								<a data-toggle="modal" href="#contact"> Contact </a>
	      							</div>
<!--
	      <div class="row-fluid">

		<div class="span12">
		  <a data-toggle="modal" href="#myModal"> View Images </a> |
		  <a href="details"> View Details </a> |
		  <a href="details"> Contact </a>
		  <a href="details">View Route</a> |
		  <a href="details"><span class="badge badge-success"> Chat</span></a>
		  <button type="submit" class="btn btn-primary">Contact Rider</button>
		  <button type="submit" class="btn btn-primary">View Route</button>
		  <button type="submit" class="btn btn-success">Chat</button>

		</div>
-->
									<div id="myModal" class="modal hide fade">
		  								<div class="modal-header">
		    								<button type="button" class="close" data-dismiss="modal">×</button>
		    								<h3>Ambanagari, Vishrantwadi, Pune</h3>
		  								</div>
		  								<div class="modal-body">
										    <div id="myCarousel" class="carousel slide">
												<div class="carousel-inner">
													<div class="active item">
						  								<img src="images/image1.jpg" alt="" align="middle">
													</div>
													<div class="item">
			  											<img src="images/image2.jpg" alt="">
													</div>
													<div class="item">
			  											<img src="images/image3.jpg" alt="">
													</div>
		     		 							</div>
		      									<a class="carousel-control left" href="#myCarousel" data-slide="prev">&lsaquo;</a>
		      									<a class="carousel-control right" href="#myCarousel" data-slide="next">&rsaquo;</a>
		    								</div>
		  								</div>
									</div>

									<div id="contact" class="modal hide fade">
		  								<div class="modal-header">
		    								<button type="button" class="close" data-dismiss="modal">×</button>
		    								<h3>Enter your contact details</h3>
		  								</div>
		  								<div class="modal-body">
		    								<form class="form-horizontal">
		    									<div class="alert alert-info">
		    										Your contact details will be sent to owner's email address and mobile.
		    									</div>
		    									<fieldset>
													<div class="control-group">
			  											<label class="control-label" for="input01">Name</label>
			  											<div class="controls">
			    											<input type="text" class="input-large" id="name" placeholder="Your Name">
			  											</div>
													</div>
													<div class="control-group">
			  											<label class="control-label" for="input01">Email</label>
			  											<div class="controls">
			    											<input type="text" class="input-large" id="email" placeholder="Your contact email">
			  											</div>
													</div>

													<div class="control-group">
			  											<label class="control-label" for="input01">Phone</label>
			  											<div class="controls">
			    											<input type="text" class="input-large" id="email" placeholder="Your contact number">
			  											</div>
													</div>

													<div class="control-group">
			  											<label class="control-label" for="textarea" >Message</label>
			  											<div class="controls">
			    											<textarea class="input-xlarge" id="textarea" rows="5">Hi, I am interested in your apartment.
			    												Please contact as soon as possible.
			    												Thanks.
			    											</textarea>
			  											</div>
													</div>
		      									</fieldset>
		    								</form>
		    								<div class="modal-footer">
		      									<a href="#" class="btn" data-dismiss="modal">Cancel</a>
		      									<a href="#" class="btn btn-primary">Send</a>
		    								</div>
		  								</div>
									</div>
	      						</div>
	    					</div>
	  					<div class="row-fluid">
	    					<hr/>
	  					</div><div class="row-fluid">
	    					<span>
	      						<b>
									<script type="IN/MemberProfile" data-id="http://in.linkedin.com/in/namratagaikwad" data-format="click" data-related="false" data-text="Namrata Gaikwad">
	      							</script>
	      						</b>
	      						<i class="icon-arrow-right">
	      						</i> Caretaker
	    					</span>
	    					<table class="table table-bordered table-striped table-condensed">
	      						<thead>
									<tr>
									<th>Type</th>
		      							<th>Area</th>
		      							<th>Rent</th>
		      							<th>Deposit</th>
										<th>Distance</th>
										<th>Published</th>
		  							</tr>
	      						</thead>
	      						<tbody>
									<tr>
										<td>1 BHK</td>
		      							<td>600 Sq Ft</td>
		      							<td><img src="images/rupee_symbol.png" alt="Rs."></img> 8,000</td>
		      							<td><img src="images/rupee_symbol.png" alt="Rs."></img> 30,000</td>
		      							<td>1 Km</td>
		      							<td>16 Aug</td>
		  							</tr>
									<tr>
		  								<td colspan="6">
		    								<i class="icon-home"></i>
		    								<a href="#" id="route" rel="tooltip" title="Click to view apartment on map">  DSK Vishwa, Pimple Saudagar, Pune</a>
		  								</td>
									<tr>
	      						</tr></tr></tbody>
	    					</table>
	  					</div><div class="row-fluid">

	    					<div class="span12">
			    				<a data-toggle="modal" href="#myModal">View Images </a> |
	      						<a href="#details"> View Details </a> |
	      						<a data-toggle="modal" href="#contact"> Contact </a>
	    					</div>

	  					</div>
	  					<div class="row-fluid">
			      			<hr/>
			    		</div>
			    	</div>
			   	</div>
      		</div>
		</div>
		
		<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
		<script type="text/javascript">/* <![CDATA[ */
			!window.jQuery && document.write('<script type="text/javascript" src="<% request.uri_base %>/javascripts/jquery.js"><\/script>')
		/* ]]> */
		</script>
		    <script type="text/javascript">

    	var map;
    	var circle;
    	var marker;
    	var infowindow;
    	var geocoder;
    	
      	$(document).ready(function(){

			$('#route').tooltip();
		  	
		  	var mapOptions = {
		    	center: new google.maps.LatLng(18.5204303, 73.8567437),
		    	zoom: 15,
		    	mapTypeId: google.maps.MapTypeId.ROADMAP
		  	};      
		  	map = new google.maps.Map(document.getElementById('map'), mapOptions);
		
		  	var placesoptions = {
		    	componentRestrictions: {country: 'IN'}
		  	};
		  	
		  	marker = new google.maps.Marker({
		    	map: map,
		    	draggable: true,
				//icon: 'images/blue-dot.png'
		  	});
		  	
		  	circle = new google.maps.Circle({
				map: map,
				fillColor: '#AA0000',
				strokeOpacity: 0.2,
				fillOpacity: 0.12
		  	});
		  	
		  	infowindow = new google.maps.InfoWindow();
		  	
		  	geocoder = new google.maps.Geocoder();
		  	
		  	navigator.geolocation.getCurrentPosition( gotPosition,
		  	 errorGettingPosition, 
		  	 {'enableHighAccuracy':false,'timeout':10000,'maximumAge':0});

		  	var toinput = document.getElementById('address');
		  	var toautocomplete = new google.maps.places.Autocomplete(toinput, placesoptions);
		  	toautocomplete.setTypes(['geocode', 'establishment']);
		  	toautocomplete.bindTo('bounds', map);

		  	google.maps.event.addListener(toautocomplete, 'place_changed', function() {
		  		
		  		var place = toautocomplete.getPlace();
		        map.setCenter(place.geometry.location);
		        
		        marker.setPosition(place.geometry.location);
		        marker.setTitle("Some title");
		        
		        infowindow.setContent('<strong>' + place.name + '</strong><br/><font size="1" color="grey">* drag marker to change location</font>');
		        infowindow.open(map, marker);

				var rad = parseFloat( $("#radius").val() );
				var zoomlevel = calculateZoomLevel(rad);
				map.setZoom(zoomlevel);
				circle.setRadius(rad);
		  		circle.bindTo('center', marker, 'position');
		    });
		    
		    google.maps.event.addListener(marker, 'dragend', function() {
		    	var newposition = marker.getPosition();
		    	$("#lat").val(newposition.lat());
		    	$("#lng").val(newposition.lng());
		    	
		    	geocoder.geocode({'latLng': newposition}, function(results, status) {
		  			if (status == google.maps.GeocoderStatus.OK) {
		    			if (results[1]) {
		    				var content = '<strong>' + results[1].formatted_address + '</strong><br/><font size="1" color="grey">* drag marker to change location</font>';
		      				infowindow.setContent(content);
		      				map.setCenter(newposition);
		      				$("#address").val(results[1].formatted_address);
		      				//infowindow.open(map, marker);
		    			}
		  			} else {
		    			alert("Geocoder failed due to: " + status);
		  			}
				});
		    	//infowindow.setContent("<strong>" + newposition.toString() + "</strong>");
		    });
		    
		    $("#radius").change(function(){
		    	var rad = parseFloat( $("#radius").val() );
				var zoomlevel = calculateZoomLevel(rad);
				map.setZoom(zoomlevel);
				circle.setRadius(rad);
		    });
		    
		    $("#address").keypress(function(e){
				if ( e.which == 13 ) return false;
			});

    });
    
    function gotPosition(pos) {
    	var newposition = new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude, false);
    	
    	marker.setPosition(newposition);
    	geocoder.geocode({'latLng': newposition}, function(results, status) {
      		if (status == google.maps.GeocoderStatus.OK) {
        		if (results[1]) {
        			var content = '<strong>' + results[1].formatted_address + '</strong><br/><font size="1" color="grey">* drag marker to change location</font>';
          			infowindow.setContent(content);
          			map.setCenter(newposition);
          			$("#address").val(results[1].formatted_address);
          			infowindow.open(map, marker);
          			
          			var rad = parseFloat( $("#radius").val() );
					var zoomlevel = calculateZoomLevel(rad);
					map.setZoom(zoomlevel);
					circle.setRadius(rad);
			  		circle.bindTo('center', marker, 'position');
        		}
      		} else {
        		alert("Geocoder failed due to: " + status);
      		}
    	});
    }
    
    function errorGettingPosition(err) {
    alert("error");
    	var defposition = new google.maps.LatLng(18.5204303, 73.8567437);
    	marker.setPosition(defposition);
    	geocoder.geocode({'latLng': defposition}, function(results, status) {
      		if (status == google.maps.GeocoderStatus.OK) {
        		if (results[1]) {
        			var content = '<strong>' + results[1].formatted_address + '</strong><br/><font size="1" color="grey">* drag marker to change location</font>';
          			infowindow.setContent(content);
          			map.setCenter(defposition);
          			$("#address").val(results[1].formatted_address);
          			infowindow.open(map, marker);
          			
          			var rad = parseFloat( $("#radius").val() );
					var zoomlevel = calculateZoomLevel(rad);
					map.setZoom(zoomlevel);
					circle.setRadius(rad);
			  		circle.bindTo('center', marker, 'position');
        		}
      		} else {
        		alert("Geocoder failed due to: " + status);
      		}
    	});
    	
    }
    
    function calculateZoomLevel(radius) {
    	var zm = 13;
    	if(radius == 2000) {
    		zm = 14;
    	}
    	if(radius == 5000) {
    		zm = 13;
    	}
    	if(radius == 10000) {
    		zm = 12;
    	}
    	if(radius == 15000) {
    		zm = 11;
    	}
    	if(radius == 20000) {
    		zm = 11;
    	}
    	if(radius == 25000) {
    		zm = 11;
    	}
    	if(radius == 30000) {
    		zm = 11;
    	}
    	return zm;
    }


	$(window).resize(function () {
    	var h = $(window).height(),
        offsetTop = 80; // Calculate the top offset

    	$('#map').css('height', (h - offsetTop));
	}).resize();
	
	$("#search").click(function() {
		var url = '/apartments?type=' + $("#type").val() + '&lat=' + $("#lat").val() + '&lng=' + $("#lng").val() + '&radius=' + $("#radius").val() + '&bedrooms=' + $("#bedrooms").val() + '&budget=' + $("#budget").val() + '&furnishing=' + $("#furnishing").val() + '&sort_by=' + $("#sort_by").val();
		$('#searchResults').load(url);
	});


    </script>

